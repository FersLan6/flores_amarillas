<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Flores Amarillas ‚Äì Para Ti</title>
  <style>
    :root{
      --bg1: #0b0f1a;   /* noche */
      --bg2: #1b2640;   /* azul profundo */
      --glow: #ffd54f;  /* brillo amarillo */
      --petal: #ffeb3b; /* p√©talo amarillo */
      --petal2:#ffd700; /* p√©talo dorado */
      --center:#6b3f00; /* centro de flor */
      --stem:#2e7d32;   /* tallo */
      --leaf:#3fa34d;   /* hoja */
      --accent:#ff6f61; /* corazones */
    }
    html,body{
      margin:0; height:100%; overflow:hidden; background: radial-gradient(1200px 800px at 70% 20%, #12203a 0%, var(--bg2) 35%, var(--bg1) 100%);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Color Emoji", "Apple Color Emoji";
    }
    /* Fondo con estrellas suaves */
    .stars{position:fixed; inset:0; pointer-events:none; background:transparent;}

    /* Contenedor principal */
    .wrap{position:fixed; inset:0; display:grid; place-items:center;}

    /* Lienzos */
    canvas{position:absolute; inset:0; width:100%; height:100%; display:block;}
    #flowers{filter: drop-shadow(0 4px 12px rgba(255,213,79,.25));}

    /* Mensaje y nombre (SVG) */
    .hero{position:absolute; inset:0; display:grid; place-items:center; text-align:center;}
    .name-svg{width:min(90vw, 900px); height:auto;}
    .subtitle{color:#ffd54f; letter-spacing:.12em; text-transform:uppercase; font-weight:600; opacity:.85; text-shadow:0 0 10px rgba(255,213,79,.5);}

    /* Bot√≥n de gesto beso */
    .cta{position:fixed; bottom:24px; left:50%; transform:translateX(-50%);} 
    .cta button{border:none; padding:14px 20px; border-radius:16px; font-size:16px; cursor:pointer; backdrop-filter: blur(6px);
      background: linear-gradient(135deg, rgba(255,235,59,.9), rgba(255,215,0,.85));
      color:#3b2f00; font-weight:700; box-shadow:0 8px 24px rgba(255,215,0,.35);
      transition: transform .15s ease, box-shadow .2s ease;} 
    .cta button:hover{transform:translateX(-0%) translateY(-2px); box-shadow:0 12px 32px rgba(255,215,0,.5);}  

    /* Tooltips */
    .hint{position:fixed; top:14px; right:16px; color:#d5d9e2; font-size:12px; opacity:.7}
    .hint b{opacity:.9}

    /* Animaci√≥n del trazo del nombre */
    .dash-animate{stroke-dasharray: var(--len); stroke-dashoffset: var(--len); animation: draw 3.6s ease forwards 1s;}
    @keyframes draw{to{stroke-dashoffset:0}}

    /* Part√≠culas de brillo */
    .glow{position:absolute; width:6px; height:6px; border-radius:50%; background:radial-gradient(circle, #fff 0%, var(--glow) 45%, transparent 65%);
      pointer-events:none; mix-blend-mode:screen; filter: blur(.5px);} 

    /* Panel de diagn√≥stico (tests) */
    #diag{position:fixed; left:12px; bottom:12px; background:rgba(0,0,0,.45); color:#ffd54f; font:12px/1.4 monospace; padding:8px 10px; border-radius:10px; display:none}
    #diag b{color:#fff3}
  </style>
</head>
<body>
  <canvas id="bg"></canvas>
  <canvas id="flowers"></canvas>
  <canvas id="floaters"></canvas>
  <div class="stars" id="stars"></div>

  <div class="hero">
    <!-- üíõ Cambia el texto entre comillas por el nombre de tu chica -->
    <svg class="name-svg" viewBox="0 0 1024 380" fill="none" xmlns="http://www.w3.org/2000/svg" aria-label="Nombre">
      <defs>
        <filter id="glow">
          <feGaussianBlur stdDeviation="3" result="blur"/>
          <feMerge>
            <feMergeNode in="blur"/>
            <feMergeNode in="SourceGraphic"/>
          </feMerge>
        </filter>
        <linearGradient id="gold" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#fff59d"/>
          <stop offset="50%" stop-color="#ffe082"/>
          <stop offset="100%" stop-color="#ffd54f"/>
        </linearGradient>
      </defs>
      <!-- Texto en trazo (animado) -->
      <path id="namePath" d="M120 250 C 220 120, 420 120, 520 250 S 780 380, 900 240" stroke="url(#gold)" stroke-width="6" fill="none" opacity=".55" filter="url(#glow)"/>
      
      <!-- Nombre principal: EDITA el texto aqu√≠ üëâ -->
      <g transform="translate(60,0)">
        <text id="nameText" x="50" y="210" font-size="65" font-weight="800" fill="url(#gold)" filter="url(#glow)" style="font-family: 'Segoe Script', 'Pacifico', 'Great Vibes', cursive; letter-spacing: 1px;">
          EVITA MI AMORSHITO üíõ
        </text>
      </g>

      <!-- Subt√≠tulo dulce -->
      <text x="512" y="320" text-anchor="middle" class="subtitle" font-size="20">Con amor y flores amarillas, hoy y siempre</text>

      <!-- Trazos brillantes decorativos -->
      <path d="M150 140 Q220 100 290 140" stroke="#fff59d" stroke-width="2" fill="none" class="dash-animate"/>
      <path d="M730 160 Q800 120 870 160" stroke="#fff59d" stroke-width="2" fill="none" class="dash-animate"/>
    </svg>
  </div>

  <div class="cta"><button id="kiss">Toca para un beso üíãüíõ</button></div>
  <div class="hint">Pulsa <b>H</b> para ocultar/mostrar el nombre ¬∑ Pulsa <b>D</b> para ver tests</div>
  <div id="diag"></div>

  <script>
  // ==========================
  // Utilidades
  // ==========================
  const rand = (a,b)=>Math.random()*(b-a)+a;
  const TAU = Math.PI*2;

  // ==========================
  // Referencias DOM (antes de cualquier uso)
  // üõ†Ô∏è Fix: mover starsDiv antes de la primera llamada a makeStars() (evita TDZ)
  // ==========================
  const bg = document.getElementById('bg');
  const flowers = document.getElementById('flowers');
  const floaters = document.getElementById('floaters');
  const starsDiv = document.getElementById('stars'); // <- ya disponible antes de resize/makeStars
  const diag = document.getElementById('diag');

  // Contextos
  const canvases = [bg, flowers, floaters];
  const ctxBg = bg.getContext('2d');
  const ctxF = flowers.getContext('2d');
  const ctxFl = floaters.getContext('2d');

  // ==========================
  // Estrellas suaves
  // ==========================
  function makeStars(){
    if(!starsDiv) return; // guard
    starsDiv.innerHTML = '';
    const N = 120;
    for(let i=0;i<N;i++){
      const s = document.createElement('div'); s.className = 'glow';
      s.style.left = rand(0, innerWidth) + 'px';
      s.style.top = rand(0, innerHeight) + 'px';
      const scale = rand(.6, 1.8);
      s.style.width = 4*scale+'px'; s.style.height = 4*scale+'px';
      s.style.opacity = rand(.15,.5);
      starsDiv.appendChild(s);
    }
  }

  // ==========================
  // Resize de lienzos
  // ==========================
  function resize(){
    const dpr = Math.min(2, window.devicePixelRatio || 1);
    for(const c of canvases){
      c.width = innerWidth * dpr; c.height = innerHeight * dpr; c.style.width = '100%'; c.style.height = '100%';
      const cx = c.getContext('2d'); cx.setTransform(dpr,0,0,dpr,0,0);
    }
    makeStars(); // usa starsDiv ya inicializado
  }
  addEventListener('resize', resize, {passive:true});

  // ==========================
  // Fondo animado sutil
  // ==========================
  let t = 0;
  function drawBg(){
    t += 0.0025;
    const g = ctxBg.createRadialGradient(innerWidth*0.7 + Math.sin(t)*40, innerHeight*0.2 + Math.cos(t)*30, 120,
                                         innerWidth*0.5, innerHeight*0.7, Math.max(innerWidth, innerHeight));
    g.addColorStop(0, '#15223a');
    g.addColorStop(.4, '#101a2f');
    g.addColorStop(1, '#0b0f1a');
    ctxBg.fillStyle = g;
    ctxBg.fillRect(0,0,innerWidth, innerHeight);
  }

  // ==========================
  // Modelo de flor
  // ==========================
  class YellowFlower{
    constructor(x,y,scale=1){
      this.x=x; this.y=y; this.scale=scale; this.angle=rand(0,TAU);
      this.grow = 0; // 0..1
      this.swing = rand(.6,1.2);
      this.petalCount = Math.floor(rand(16,26));
    }
    draw(ctx){
      ctx.save();
      ctx.translate(this.x, this.y);
      // Tallo
      ctx.rotate(Math.sin((Date.now()+this.x)*0.001)*0.02);
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--stem');
      ctx.beginPath();
      ctx.moveTo(0,0); ctx.quadraticCurveTo(10,60*this.scale, 0, 120*this.scale); ctx.lineTo(-4,120*this.scale); ctx.quadraticCurveTo(6,60*this.scale, -4,0); ctx.closePath(); ctx.fill();
      // Hoja
      ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--leaf');
      ctx.beginPath(); ctx.ellipse(-10, 60*this.scale, 18*this.scale, 10*this.scale, -.6, 0, TAU); ctx.fill();

      // Cabeza de flor
      ctx.save();
      const grow = this.grow;
      ctx.scale(this.scale*grow, this.scale*grow);
      // p√©talos
      for(let i=0;i<this.petalCount;i++){
        const a = (i/this.petalCount)*TAU + Math.sin(Date.now()*0.001 + this.x*0.01)*0.05;
        const r = 26 + 2*Math.sin(i*0.7 + Date.now()*0.002);
        ctx.save(); ctx.rotate(a);
        const grd = ctx.createLinearGradient(0,0,0,-r);
        grd.addColorStop(0, '#ffd700');
        grd.addColorStop(.6, '#ffeb3b');
        grd.addColorStop(1, '#fff59d');
        ctx.fillStyle = grd;
        ctx.beginPath();
        ctx.moveTo(0,0);
        ctx.quadraticCurveTo(10,-r*0.6, 0,-r);
        ctx.quadraticCurveTo(-10,-r*0.6, 0,0);
        ctx.closePath(); ctx.fill();
        ctx.restore();
      }
      // centro
      ctx.fillStyle = '#6b3f00';
      ctx.beginPath(); ctx.arc(0,0,12,0,TAU); ctx.fill();
      ctx.fillStyle = '#9c6400'; ctx.beginPath(); ctx.arc(-3,-3,5,0,TAU); ctx.fill();
      ctx.restore();
      ctx.restore();
      // crecimiento
      this.grow = Math.min(1, this.grow + 0.01);
    }
  }

  const bouquet = [];
  function seedBouquet(){
    bouquet.length = 0;
    const cols = Math.floor(innerWidth/180);
    const rows = Math.floor(innerHeight/260);
    for(let y=0;y<=rows;y++){
      for(let x=0;x<=cols;x++){
        const px = (x+0.5)*innerWidth/(cols+1) + rand(-20,20);
        const py = innerHeight*0.55 + rand(-20,40) + y*12;
        bouquet.push(new YellowFlower(px, py, rand(0.9, 1.2)));
      }
    }
  }
  seedBouquet();
  addEventListener('resize', seedBouquet, {passive:true});

  // ==========================
  // P√©talos flotantes & corazones
  // ==========================
  const floatersArr = [];
  function spawnFloater(burst=false, x=rand(0,innerWidth), y=rand(innerHeight*0.4, innerHeight*0.9)){
    const n = burst? 40: 1;
    for(let i=0;i<n;i++){
      floatersArr.push({
        x: x + rand(-20,20), y: y + rand(-20,20),
        vx: rand(-0.6,0.6), vy: rand(-1.2,-0.2),
        r: rand(6,10), rot: rand(0,TAU), vr: rand(-0.02,0.02), life: rand(220,420)
      });
    }
  }
  setInterval(()=>spawnFloater(false), 240);

  const hearts=[];
  function heartBurst(){
    const cx = innerWidth/2, cy = innerHeight*0.65;
    for(let i=0;i<28;i++){
      hearts.push({x:cx, y:cy, vx:rand(-2,2), vy:rand(-3.2,-1.2), a:1, s:rand(0.6,1.2)});
    }
    spawnFloater(true, cx, cy);
  }
  document.getElementById('kiss').addEventListener('click', heartBurst);

  // ==========================
  // Teclas
  // ==========================
  let showName = true;
  addEventListener('keydown', (e)=>{
    const k = e.key.toLowerCase();
    if(k==='h'){
      showName = !showName; document.querySelector('.hero').style.display = showName? 'grid':'none';
    } else if(k==='d'){
      diag.style.display = diag.style.display==='none' || !diag.style.display ? 'block':'none';
      updateDiagnostics();
    }
  });

  // ==========================
  // Render principal
  // ==========================
  function drawFloaters(){
    ctxFl.clearRect(0,0,innerWidth, innerHeight);
    // p√©talos
    for(let i=floatersArr.length-1;i>=0;i--){
      const p = floatersArr[i];
      p.x += p.vx; p.y += p.vy; p.rot += p.vr; p.life -= 1;
      if(p.life<=0 || p.y < -20){ floatersArr.splice(i,1); continue; }
      ctxFl.save(); ctxFl.translate(p.x, p.y); ctxFl.rotate(p.rot);
      const grd = ctxFl.createLinearGradient(0,0,0,-p.r);
      grd.addColorStop(0,'#ffd700'); grd.addColorStop(1,'#ffeb3b');
      ctxFl.fillStyle = grd;
      ctxFl.beginPath(); ctxFl.moveTo(0,0); ctxFl.quadraticCurveTo(6,-p.r*0.6, 0,-p.r); ctxFl.quadraticCurveTo(-6,-p.r*0.6, 0,0); ctxFl.fill();
      ctxFl.restore();
    }
    // corazones
    for(let i=hearts.length-1;i>=0;i--){
      const h = hearts[i];
      h.x += h.vx; h.y += h.vy; h.vy += 0.03; h.a -= 0.01;
      if(h.a<=0) { hearts.splice(i,1); continue; }
      ctxFl.save(); ctxFl.globalAlpha = Math.max(0,h.a);
      ctxFl.translate(h.x, h.y); ctxFl.scale(h.s, h.s);
      ctxFl.fillStyle = '#ff6f61';
      ctxFl.beginPath();
      ctxFl.moveTo(0,0);
      ctxFl.bezierCurveTo(0,-12, -16,-12, -16,4);
      ctxFl.bezierCurveTo(-16,16, 0,22, 0,30);
      ctxFl.bezierCurveTo(0,22, 16,16, 16,4);
      ctxFl.bezierCurveTo(16,-12, 0,-12, 0,0);
      ctxFl.fill();
      ctxFl.restore();
    }
  }

  function loop(){
    drawBg();
    ctxF.clearRect(0,0,innerWidth, innerHeight);
    for(const f of bouquet){ f.draw(ctxF); }
    drawFloaters();
    requestAnimationFrame(loop);
  }

  // ==========================
  // Tests / Diagn√≥stico (simples)
  // ==========================
  function updateDiagnostics(){
    if(!diag || diag.style.display==='none') return;
    diag.innerHTML = `
      <div><b>tests</b></div>
      starsDiv: ${!!starsDiv} ¬∑ children=${starsDiv ? starsDiv.childElementCount : 0}<br/>
      ctxBg: ${!!ctxBg} ¬∑ ctxF: ${!!ctxF} ¬∑ ctxFl: ${!!ctxFl}<br/>
      bouquet: ${bouquet.length} ¬∑ floaters: ${floatersArr.length} ¬∑ hearts: ${hearts.length}
    `;
  }

  function selfTests(){
    try{
      console.assert(!!starsDiv, 'starsDiv debe existir antes de makeStars');
      console.assert(!!ctxBg && !!ctxF && !!ctxFl, 'Los contextos de canvas deben estar disponibles');
      const nt = document.getElementById('nameText');
      console.assert(!!nt, 'nameText debe existir');
      // Comprobaci√≥n de par√°metro ?n= (no altera si no existe)
      const params = new URLSearchParams(location.search);
      const tempN = params.get('n');
      if(tempN){ nt.textContent = tempN + ' \uD83D\uDC9B'; }
      console.log('%c[OK] Self-tests b√°sicos superados', 'color:#ffd54f');
    }catch(e){
      console.error('[Fallo en self-tests]', e);
    }
  }

  // ==========================
  // Inicio
  // ==========================
  selfTests();
  resize();
  loop();

  // Toque en pantalla: p√©talos donde tocas
  addEventListener('pointerdown', (e)=>{ spawnFloater(true, e.clientX, e.clientY); updateDiagnostics(); });

  // Ajuste de animaci√≥n de trazo
  const dashElems = document.querySelectorAll('.dash-animate');
  dashElems.forEach(el=>{
    const len = el.getTotalLength();
    el.style.setProperty('--len', len);
  });

  // üåü Extra: al entrar, un peque√±o beso autom√°tico
  setTimeout(()=>{ heartBurst(); updateDiagnostics(); }, 1200);

  // Helper para cambiar nombre por query (?n=Tu%20Nombre)
  const params = new URLSearchParams(location.search);
  const n = params.get('n');
  if(n){ document.getElementById('nameText').textContent = n + ' \uD83D\uDC9B'; }
  </script>
</body>
</html>
